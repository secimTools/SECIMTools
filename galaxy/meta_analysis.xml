<tool id="secimtools_meta_analysis" name="Meta-Analysis" version="@WRAPPER_VERSION@">
    <description> run statistical analyses to determine the extent of batch effects on a set of data </description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
meta_analysis.py
--wide $input
--design $design
--uniqID $uniqID
--study $study
--treatment "$treatment"
--contrast $contrast

##Default is set to only use Fixed-effect model, use standard mean difference for effect size, and unbiased estimation for cmMethod 
--model "FE"
--effectSize "SMD"
--cmMethod "UB"
--summary $summary
--report $report

    ]]></command>
    <inputs>
        <param name="input" type="data" format="tabular" label="Wide Dataset" help="Input your tab-separated wide format dataset. If file is not tab-separated see TIP below."/>
        <param name="design" type="data" format="tabular" label="Design File" help="Input your design file (tab-separated). Note you need a 'sampleID' column. If not tab separated see TIP below."/>
        <param name="uniqID" size="30" type="text" value="" label="Unique Feature ID" help="Name of the column in your wide dataset that contains unique feature identifiers."/>
        <param name="study" type="text" size="30" value="batch" label="Study" help="Name of the column in your design file that contains batch information."/>
        <param name="treatment" type="text" size="30" label="Treatment/Group" help="Name of the column in your design file that specifies which mutants and wildtype genotypes are to be compared"/>
        <param name="contrast" type="text"  size="30" label="The contrast to be used for the meta-analysis" help="Enter the name of the mutant that will be compared followed by the wildtype. Make sure these are only separated by a single comma (no spaces)"/>
    </inputs>
    <outputs>
        <data format="tsv" name="report" label="${tool.name} on ${on_string}: Report"  />
        <data format="csv" name="summary" label="${tool.name} on ${on_string}: Summary"/>
    </outputs>
    <tests>
        <test>
            <param name="input"  value="ready_cdcl3_rank_sbys.tsv"/>
            <param name="design" value="dsgn_nmr_4_MA_cdcl3_set1_CB4856.tsv"/>
            <param name="uniqID" value="ppm" />
            <param name="study"  value="batch" />
            <param name="treatment" value="genotype" />
            <param name="contrast" value="PD1074,CB4856" />
            <output name="report" file="meta_analysis_report.tsv" />
            <output name="summary" file="meta_analysis_summary.csv" />
        </test>
    </tests>
    <help><![CDATA[

@TIP_AND_WARNING@

**Tool Description**

The meta-analysis tool is used to study batch effect corrections in large-scale metabolomics studies. In large scale studies, samples are broken up into several batches, where each batch constitutes replicates of a sample. Batch effects can occur biases when testing on the replicates, can be caused due to differences in laboratory conditions that the batches are run under, such as temperature, amount of reagents used, and even particles that are leftover from past runs in the LC/MS equipment. This tool is used to determine the extent to which batch effects are present so that steps may be taken to minimize them. 


--------------------------------------------------------------------------------

**Input**

    - Two input datasets are required.

@WIDE@

**NOTE:** The sample IDs must match the sample IDs in the Design File
(below). Extra columns will automatically be ignored.

@METADATA@

@UNIQID@

**Study**


**Treatment**

    - Enter the name of the column that contains the list of the different strains that are to be compared. For example, if the mutant is KJ550 and the wildtype is PD1074, then these should both be under one column designating the genotype/strain to be compared. 

@GROUP@

**Contrast**

    - Name of the group(s) that you want to process. Separate multiple genotypes/strains with commas (no spaces)

--------------------------------------------------------------------------------

**Output**

This tool outputs two different files:
(1) a summary CSV file that contains the statistical metrics of the batch effect
(2) a report file 
    ]]></help>
    <expand macro="citations"/>
</tool>
