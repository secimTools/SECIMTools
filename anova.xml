<tool id="anova-single-file" name="One-Way ANOVA">
  <description> for two or more groups.</description>
  <requirements>
    <requirement type="python-module">numpy</requirement>
    <requirement type="python-module">scipy</requirement>
    <requirement type="python-module">pandas</requirement>
    <requirement type="python-module">statsmodels</requirement>
    <requirement type="python-module">matplotlib</requirement>
  </requirements>
  <command interpreter="python">anova.py
      --input $input
      --design $design
      --ID $uniqID
      --group $group
      --out $results_table
      --fig $qq_plots
      --fig2 $volcano_plots
  </command>
  <inputs>
    <param name="input" type="data" format="tabular" label="Wide Dataset" help="Input dataset in wide format and tab separated. If file is not tab separated see TIP below."/>
    <param name="design" type="data" format="tabular" label="Metadata File" help="Metadata file tab separated. Note you need a 'sampleID' column. If not tab separated see TIP below"/>
    <param name="uniqID" type="text" size="30" value="" label="Unique Compound ID" help="Name of the column in your Wide Dataset that has unique compound/gene IDs."/>
    <param name="group" type="text" size="30" value="" label="Group/Treatment" help="Name of the column in your Metadata File that contains group classifications."/>
  </inputs>
  <outputs>
    <data format="tabular" name="results_table" label="Anova_results_table"/>
    <data format="pdf" name="qq_plots" label="Anova_qq_plots"/>
    <data format="pdf" name="volcano_plots" label="Anova_volcano_plots"/>
  </outputs>
  <macros>
      <import>macros.xml</import>
  </macros>
  <tests>
    <test>
      <param name="input" value="./test-data/test_data.tsv " ftype="tabular"/>
      <param name="design" value="./test-data/test_design.csv" ftype="tabular"/>
      <param name="uniqID" value="rowID"/>
      <param name="group" value="treatment"/>
      <output name="results_table" file="./test-data/test_anova_tsv.tsv" />
      <output name="qq_plots" file="./test-data/test_anova_fig.tsv" />
      <output name="volcano_plots" file="./test-data/test_anova_fig2.tsv" />
    </test>
  </tests>
<help>

@TIP_AND_WARNING@

**What it does**

This tool does row-by-row analysis calculating a One-Way-ANOVA on the selected groups.

- Two input datasets are required.

    @WIDE@

        **NOTE:** The sample IDs must match the sample IDs in the Metadata File
        (below). Extra columns will automatically be ignored.


    @METADATA@

    **In addition to your datasets, you need to provide:**


    **Unique Compound ID**

    - The column name in your wide dataset that contains the unique IDs for
      your compounds. In our example dataset you would input *Compound*.
   

    @GROUP@

--------------------------------------------------------------------------------

**Output Files**

This tool outputs 3 different files.

    - **(1) results_table** is a `TSV` table that contains the One-Way-ANOVA
      results and the analysis of means. File headers follow the SAS JMP
      Genomics conventions (http://www.jmp.com/support/help/).

    - **(2) qq_plots** is a `PDF` file containing, for each sample, various
      plots of the residuals. Plots include (i) q-q plots to check for normality
      and (ii) residuals vs fits plots to verify that the residuals are normally
      distributed.

    - **(3) volcano_plots** is a `PDF` file containing volcano plots for
      visualizing data-points with large changes between group means. The red
      line shows p = 0.05.

</help>
</tool>

