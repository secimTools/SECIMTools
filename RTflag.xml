<tool id="RTflag2" name="RT flags (Beta)" version="2.0.0">
  <description>Calculate RT flags</description>
  <requirements>
    <requirement type="python-module">numpy</requirement>
    <requirement type="python-module">pandas</requirement>
    <requirement type="python-module">matplotlib</requirement>
    <requirement type="python-module">scipy</requirement>
    <requirement type="python-module">palettable</requirement>
  </requirements>
  <stdio>
    <exit_code range="1:" level="warning" description="RuntimeWarning"/>
  </stdio>
  <command interpreter="python">RTflag.py
      --input $input
      --design $design
      --ID $uniqID
      --figure $RTplot
      --flag $RTflag
      --minutes $minutes

      #if $CVcutoff:
	    --CVcutoff $CVcutoff
      #end if
      #if $pctl
        --pctl
      #end if
  </command>
  <inputs>
    <param name="input" type="data" format="tabular" label="Wide Dataset" help="Input dataset in wide format and tab separated. If file is not tab separated see TIP below."/>
    <param name="design" type="data" format="tabular" label="Design File" help="Design file tab separated. Note you need a 'sampleID' column. If not tab separated see TIP below"/>
    <param name="uniqID" type="text" size="30" value="" label="Unique Feature ID" help="Name of the column in your Wide Dataset that has unique Feature IDs."/>
    <param name="minutes" type="float" size="30" value=".2" label="Percentile Cutoff" help="Percenctile cutoff in minutes. The default value used is 0.2 minutes" />
    <param name="CVcutoff" optional="true" type="float" value=".1" size="4" label="CVcutoff [OPTIONAL]" help="The default CV cutoff will flag 10 percent of the rowIDs with larger CVs. If you want to set a CV cutoff, put the number here."/>
    <param name="pctl" type="boolean" size="30" label="90th percentile [OPTIONAL]" help="Check this box to use a 90th percentile. The default is a 95th percentile (NO). [OPTIONAL]" />
  </inputs>
  <outputs>
    <data format="pdf" name="RTplot"  label="RTplot" />
    <data format="tabular" name="RTflag"  label="RTflag" />
  </outputs>
  <macros>
      <import>macros.xml</import>
  </macros>
<help>

@TIP_AND_WARNING@

**What it does**

This tool identifies features with the following characteristics:
    (1) features whose coefficient of variation in retention time is greater than 95% (default value) of all features and
    (2) features where the difference in the retention time between the 95th and 10th percentiles (default values) is greater than 0.2 minutes.
    (3) features where the difference between the retention time maximum and median is greater than 0.1 minutes.
    (4) features where the difference between the retention time minimum and median is greater than 0.1 minutes.
    (5) features where the retention time minimum or maximum is greater than 3 times the standard deviation away from the mean.

--------------------------------------------------------------------------------

**Input**

- Two input datasets are required.

    @WIDE@

    **NOTE:** The sample IDs must match the sample IDs in the Design File (below).
    Extra columns will automatically be ignored.


    @METADATA@

**In addition to your datasets, you need to provide:**

    **Unique Feature ID**

        - The column name in your wide dataset that contains the unique IDs for
          your features. In our example dataset you would input *Feature*.

    **Cvcutoff**  [Optional]

        - The column name in your design file that contains group information. In
          our example design file we would put *group1*.

    **90th percentile**  [Optional]

        - The default is to flag features when the difference in the retention time between the 95th and 5th percentiles is greater
          than 0.2 minutes. The user has the option to select the 90th and 10th percentiles instead.

--------------------------------------------------------------------------------

**Output Files**

- The tool generates 2 output datasets.

    **CVplotForRT** is a PDF density plot of the coefficients of variation for the retention time.

    **RTflag** is a TSV file containing the 5 retention time 0/1 indicator flags for each feature.

</help>
</tool>
