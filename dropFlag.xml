<tool id="dropFlag" name="Drop Flags">
    <description>Drop flagged values from data</description>
    <requirements>
        <requirement type="python-module">numpy</requirement>
        <requirement type="python-module">pandas</requirement>
    </requirements>
    <command interpreter="python">dropFlag.py
        --input $input
        --design $design
        --ID $uniqID
        --wideOut $wideOut
        --flags $flags
        --cutoff $cutoff

        #if $group
        --group $group
        #end if

        #if str( $drop ) == 'row'
        --row
        #end if
        #if str( $drop ) == 'column'
        --column --designOut $designOut
        #end if
    </command>
    <inputs>
        <param name="input" type="data" format="tabular" label="Wide Dataset"
               help="Input dataset in wide format and tab separated. If file is not tab separated see TIP below."/>
        <param name="design" type="data" format="tabular" label="Metadata File"
               help="Metadata file tab separated. Note you need a 'sampleID' column. If not tab separated see TIP below"/>
        <param name="uniqID" type="text" size="30" value="" label="Unique Feature ID"
               help="Name of the column in your Wide Dataset that has unique feature/compound/gene IDs."/>
        <param name="group" type="text" size="30" value="" optional="true" label="Group/Treatment [Optional]"
               help="Name of the column in your Metadata File that contains group classifications."/>
        <param name="flags" type="data" format="tabular" label="Flag File"
               help="Input flagged dataset containing the flag value for each feature"/>
        <param name="cutoff" type="float" size="30"  value=".5" label="Cutoff Value"
               help="Input value for cutoff. Any rows with a flag average value greater than this number will be dropped."/>
        <param name="drop" type="select" size="30" display="radio" value="" label="Drop rows or columns"
               help="Choose whether to drop rows or columns">
            <option value="row" selected="true">Drop the row value</option>
            <option value="column">Drop the column value</option>
        </param>
    </inputs>
    <outputs>
        <data format="tabular" name="wideOut" label="DroppedWide"/>
        <data format="tabular" name="designOut" label="DroppedMetadata">
            <filter>drop=='column'</filter>
        </data>
    </outputs>
    <macros>
        <import>macros.xml</import>
    </macros>
    <tests>
        <test>
            <param name="input" value="./test-data/test_data.tsv" />
            <param name="design" value="./test-data/test_design.csv" />
            <param name="uniqID" value="rowID" />
            <param name="group" value="treatment" />
            <param name="flags" value="./test-data/test_flag.tsv" />
            <param name="cutoff" value=".5" />
            <output name="wideOut" file="./test-data/test_dropFlag_wideOut.tsv" />
            <output name="designOut" file="./test-data/test_dropFlag_designOut.tsv" />
        </test>
    </tests>
<help>

@TIP_AND_WARNING@

**What it does**

This tool takes a Wide formatted dataset, a Metadata dataset and a file
containing 0/1 indicator flags and drops values based on a user selected
cutoff value. For feature 0/1 indicator flags, features are dropped from the Wide
dataset if the sum of all 0/1 indicator flags for a given feature is greater
than the cutoff value input by the user. For sample 0/1 indicator flags, samples
are dropped from the Wide dataset if the sum of all 0/1 indicator flags for a
given sample is greater than the cutoff value input by the user. Note that
features and samples are dropped in separate operations.

--------------------------------------------------------------------------------

**Input**

- Two input datasets are required.

    @WIDE@

    **NOTE:** The sample IDs must match the sample IDs in the Metadata File
    (below). Extra columns will automatically be ignored.


    @METADATA@

    **In addition to your datasets, you need to provide:**

    **Unique Feature ID**

    - The column name in your wide dataset that contains the unique IDs for
      your features. In our example dataset you would input *Feature*

      @GROUP_OPTIONAL@

    **Flag 0/1 Indicator File:** A flag indicator file corresponding to flagged
    (0/1) values for features (shown below) or samples::

        +----------+---------+---------+---------+-----+
        | Feature  | flag_A | flag_B   | flag_C  | ... |
        +==========+=========+=========+=========+=====+
        | one      | 0       | 0       | 0       | ... |
        | two      | 0       | 1       | 1       | ... |
        | three    | 0       | 1       | 0       | ... |
        | four     | 1       | 0       | 0       | ... |
        | ...      | ...     | ...     | ...     | ... |
        +----------+---------+---------+---------+-----+


    **Cutoff Value**

    If the sum of all the flags for a feature or sample is greater than this
    value, then that feature or sample will be dropped from the wide dataset.

    **Drop rows or columns**

    Select either rows or columns for dropping

--------------------------------------------------------------------------------

**Output Files**

- If dropping features:

    **modified_wide** file will be created that contains only the features where
    the sum of all indicator flags for the feature is less than the user given
    cutoff value.

- If dropping samples:

    **modified_wide** file will be created that contains only the features where
    the sum of all indicator flags for the feature is less than the user given
    cutoff value.

    **modified_metadata** file will be created that contains only the samples where
    the sum of all the indicator flags for the sample is less than the user given
    cutoff value.


</help>
</tool>
